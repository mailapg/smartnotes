{% extends "index.html" %}
{% block content %}
<h1><i class="fa-solid fa-code-branch"></i> Alle Notizen</h1>
 
<div style="display: flex; justify-content: space-between; align-items: center;">
  <div class="filter-tags">
    <h3>Filter:</h3>
    <div class="tags">
      {% for tag in all_tags %}
      <button
        type="button"
        class="tag-btn {% if tag in active_tags %}active{% endif %}"
        onclick="toggleTag('{{ tag }}')">
        {{ tag }}
      </button>
      {% endfor %}
      <a href="/list" class="btn btn-reset">Reset</a>
    </div>
  </div>
 
  <form method="get" action="/list" style="display: flex; align-items: center; margin-left: auto;">
    <input type="text" name="q" placeholder="Suche..." value="{{ search_query }}" style="padding: 6px 10px; border-radius: 6px 0 0 6px; border: 1px solid #ccc;">
    <button type="submit" style="padding: 6px 12px; border: 1px solid #ccc; border-left: none; border-radius: 0 6px 6px 0; background: #84919a; color: white; cursor: pointer;">
      <i class="fa fa-search"></i>
    </button>
  </form>
</div>
 
<hr />
 
{% for note in notes %}
<div class="note">
  <h3>{{ note.title }}</h3>
  <p>{{ note.content }}</p>
  <small>Erstellt am: {{ note.created_at }}</small>
  {% if note.updated_at %}
  <br>
  <small>Zuletzt geändert am: {{ note.updated_at }}</small>
  {% endif %}
  <div class="tags">
    {% for tag in note.tags %}
    <span class="tag">{{ tag }}</span>
    {% endfor %}
  </div>
  <div class="note-actions">
    <a href="/edit/{{ note._id }}" class="btn btn-edit">
      <i class="fa-solid fa-pen"></i>
    </a>
    <a href="#" class="btn btn-delete" onclick="deleteNote('{{ note._id }}')">
      <i class="fa-solid fa-trash"></i>
    </a>
  </div>
</div>
{% endfor %}
 
<script>
  let activeTags = new URLSearchParams(window.location.search).get("tags");
  activeTags = activeTags ? activeTags.split(",") : [];
 
  function toggleTag(tag) {
    if (activeTags.includes(tag)) {
      activeTags = activeTags.filter(t => t !== tag);
    } else {
      activeTags.push(tag);
    }
    const params = new URLSearchParams(window.location.search);
    if (activeTags.length > 0) {
      params.set("tags", activeTags.join(","));
    } else {
      params.delete("tags");
    }
    window.location.href = "/list?" + params.toString();
  }
 
  async function deleteNote(id) {
    if (confirm('Diese Notiz wirklich löschen?')) {
      await fetch(`/delete/${id}`, { method: 'DELETE' });
      window.location.href = '/list';
    }
  }
</script>
 
<style>
  .tag-btn {
    margin: 4px;
    padding: 8px 14px;
    border: 2px solid #888;
    border-radius: 20px;
    background: #84919a;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
  }
 
  .tag-btn:hover {
    background: #cad9e8;
  }
 
  .tag-btn.active {
    background: #28a745;       /* kräftiges Grün */
    color: #fff;
    border-color: #1e7e34;
    box-shadow: 0 0 5px rgba(40,167,69,0.6);
  }
 
  .btn-reset {
    margin-left: 10px;
    text-decoration: none;
    padding: 8px 14px;
    background: #84919a;       /* Rot für Reset */
    color: #fff;
    border-radius: 20px;
    border: none;
    cursor: pointer;
    font-size: 14px;
  }
 
  .btn-reset:hover {
    background: #4f575d;
  }

  .search-form {
    display: flex;
    align-items: center;
    margin-left: auto;
  }
 
  .search-input {
    padding: 6px 10px;
    border-radius: 6px 0 0 6px;
    border: 1px solid #ccc;
    outline: none;
  }
 
  .search-btn {
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-left: none;
    border-radius: 0 6px 6px 0;
    background: #84919a;
    color: white;
    cursor: pointer;
  }
 
  .search-btn:hover {
    background: #4f575d;
  }
</style>
{% endblock %}