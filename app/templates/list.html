{% extends "index.html" %} {% block content %}
<div style="display: flex; justify-content: space-between; align-items: center">
  <h1><i class="fa-solid fa-code-branch"></i> Alle Notizen</h1>
  <form method="get" action="/list" class="search-form">
    <input
      type="text"
      name="q"
      placeholder="Suche..."
      value="{{ search_query }}"
      class="search-input" />
    <button type="submit" class="search-btn">
      <i class="fa fa-search"></i>
    </button>
  </form>
</div>

<div style="margin-bottom: 10px">
  {% for tag in all_tags %}
  <button
    type="button"
    class="tag-btn {% if tag in active_tags %}active{% endif %}"
    onclick="toggleTag('{{ tag }}')">
    {{ tag }}
  </button>
  {% endfor %}
  <a href="/list" class="tag-btn btn-reset">Reset</a>
</div>

{% for note in notes %}
<div class="note">
  <h3>{{ note.title }}</h3>
  <p>{{ note.content }}</p>
  <small>Erstellt am: {{ note.created_at }}</small>
  {% if note.updated_at %}
  <br />
  <small>Zuletzt geändert am: {{ note.updated_at }}</small>
  {% endif %}
  <div
    style="display: flex; justify-content: space-between; align-items: center">
    <div class="tags">
      {% for tag in note.tags %}
      <span class="tag">{{ tag }}</span>
      {% endfor %}
    </div>
    <div class="note-actions">
      <a href="/edit/{{ note._id }}" class="btn btn-edit">
        <i class="fa-solid fa-pen"></i>
      </a>
      <a href="#" class="btn btn-delete" onclick="deleteNote('{{ note._id }}')">
        <i class="fa-solid fa-trash"></i>
      </a>
    </div>
  </div>
</div>
{% endfor %}

<script>
  let activeTags = new URLSearchParams(window.location.search).get('tags');
  activeTags = activeTags ? activeTags.split(',') : [];

  function toggleTag(tag) {
    if (activeTags.includes(tag)) {
      activeTags = activeTags.filter((t) => t !== tag);
    } else {
      activeTags.push(tag);
    }
    const params = new URLSearchParams(window.location.search);
    if (activeTags.length > 0) {
      params.set('tags', activeTags.join(','));
    } else {
      params.delete('tags');
    }
    window.location.href = '/list?' + params.toString();
  }

  async function deleteNote(id) {
    if (confirm('Diese Notiz wirklich löschen?')) {
      await fetch(`/delete/${id}`, { method: 'DELETE' });
      window.location.href = '/list';
    }
  }
</script>
{% endblock %}
